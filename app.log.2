2024-04-11 09:32:27,597 - app - INFO - Received messages: [{'role': 'system', 'content': 'You are a knowledgeable assistant, specializing in IT and mechanical operations, tasked with providing expert-level, yet accessible, support. Your goal is to offer accurate and factual information, with an emphasis on clear and simplified explanations suitable for both engineers and novice end users. Where possible, present your reasoning in a step-by-step format, ensuring your explanations can be easily followed and understood.\n\nWhen faced with uncertainties, honesty is vital – acknowledge any gaps in your knowledge, and avoid making assumptions. If additional context is needed to form a precise answer, do not hesitate to request it. We highly value references or sources for your information, and where relevant, suggest further resources for in-depth understanding.\n\nIn your responses, please detail the potential implications and future challenges that might stem from the proposed solutions, promoting a proactive approach to problem-solving. Aim to demystify technical jargon, breaking down complex concepts into user-friendly language to bridge the gap between experts and novices.\n\nUpon receiving a troubleshooting scenario, provide insightful feedback or strategies, focusing on relevance, practicality, and foresight in addressing the issue at hand.'}, {'role': 'user', 'content': "I need some assistance with troubleshooting an Exchange mailbox. Here is the content of an email with Dell support, who is also helping me on finding a resolution. I need some help with getting connected using PowerShell and then working through the recommendations from Dell. Microsoft 365 from Dell Ticket: 188486594 Hello, Kevin Atkinson Thank you for your reply Please use this PS command to identify the policy's assigned to the mailbox Get-Mailbox <Identity> | fl InPlaceHolds, Retention*, ELC* Use the PS command to start the Managed folder assistant and recalculate the whole mailbox Start-ManagedFolderAssistant -Identity <User> -FullCrawl This can take up to 7 days after issuing the command verify the MFA processing $MRMLogs = [xml] ((Export-MailboxDiagnosticLogs <user> -ExtendedProperties).mailboxlog) $MRMLogs.Properties.MailboxTable.Property | ? {$_.Name -like “*ELC*”} ¬The output will show the number of deleted or archived items that processed last time as well as the time stamp of the last successful run. You can also check the folder statistics Get-MailboxFolderStatistics <User> -FolderScope inbox -IncludeOldestAndNewestItems -IncludeAnalysis | select name, items*, oldes*, top* And check if there aren't files larger than 150 MB or if there aren't any folders with large items count (Over 1 million ) Please send me results of these commands For more details please check: https://techcommunity.microsoft.com/t5/exchange-team-blog/troubleshooting-retention-policies-in-exchange-online/ba-p/3750197 Kind regards Michal Doblej Senior Technician, Technical Support Dell Technologies | CSG Managed AaS Delivery Services --------------- Original Message --------------- From: Kevin Atkinson [kevin.atkinson@hkpseattle.com] Sent: 4/10/2024, 5:00 PM To: technical_support@help.dell.com Subject: RE: Retention Policy not Working ? [ thread::Zr2JDBp_LUq5_ZaJ5Rm0KD0:: ] [EXTERNAL EMAIL] I first setup the retention policy well over a week ago. (Looking at my records, it was 3/22.) While troubleshooting this yesterday, I manually triggered the managed folder assistant via PowerShell. This morning, still no change. By my eye, everything looks configured correctly… I’m at a loss as to why it’s not working. FWIW, I have reached out to my Dell rep to change the licensing on the mailbox as well. Thanks, Kevin Kevin Atkinson Director of Operations Hagen, Kurth, Perman & Co., P.S. 1111 Third Ave, Suite 800 Seattle, WA 98101 (206) 682-9200 www.hkpseattle.com [hkpseattle.com] From: Dell Tech Support <technical_support@help.dell.com> Sent: Wednesday, April 10, 2024 4:36 AM To: Kevin Atkinson <kevin.atkinson@hkpseattle.com> Subject: RE: Retention Policy not Working ? [ thread::Zr2JDBp_LUq5_ZaJ5Rm0KD0:: ] Microsoft 365 from Dell Ticket: 188486594 Hello, Kevin Atkinson Please let me know when was the retention policy applied on the mailbox as it can take up to a week till the actual retention will start to be performed on the mailbox as the retention is being done by an timed job (Managed folder assistant) running in the background once per week which is checking the Mailbox items and retention settings used for them. To increase the storage space of the main mailbox you can license it with Exchange online plan 2 or any other subscription containing Exchange online plan 2 in order to receive 100GB of space. Kind regards Michal Doblej Senior Technician, Technical Support Dell Technologies | CSG Managed AaS Delivery Services --------------- Original Message --------------- From: Kevin Atkinson [kevin.atkinson@hkpseattle.com] Sent: 4/9/2024, 10:11 PM To: technical_support@help.dell.com Subject: RE: Retention Policy not Working ? [ thread::Zr2JDBp_LUq5_ZaJ5Rm0KD0:: ] [EXTERNAL EMAIL] Thanks for the quick response. Dell Customer Number: 6033353 Company Name: Hagen, Kurth, Perman & CO, PS Kevin Kevin Atkinson Director of Operations Hagen, Kurth, Perman & Co., P.S. 1111 Third Ave, Suite 800 Seattle, WA 98101 (206) 682-9200 www.hkpseattle.com [hkpseattle.com] From: Dell Tech Support <technical_support@help.dell.com> Sent: Tuesday, April 9, 2024 12:08 PM To: Kevin Atkinson <kevin.atkinson@hkpseattle.com> Subject: RE: Retention Policy not Working ? [ thread::Zr2JDBp_LUq5_ZaJ5Rm0KD0:: ] Microsoft 365 from Dell Ticket: 188486594 Hello, Kevin Atkinson Thank you for contacting the Microsoft 365 from Dell team. Please provide me with the requested details Dell Customer Number - Account / Company Name - Kind regards Michal Doblej Senior Technician, Technical Support Dell Technologies | CSG Managed AaS Delivery Services --------------- Original Message --------------- From: CloudSoftware [cloudsoftwarehelp@dell.com] Sent: 4/9/2024, 8:59 PM To: kevin.atkinson@hkpseattle.com Subject: RE: Retention Policy not Working ? [ thread::Zr2JDBp_LUq5_ZaJ5Rm0KD0:: ] Microsoft 365 from Dell Ticket: 188486594 Hello Kevin, Thank you for contacting the Microsoft 365 from Dell team. We have received your ticket and are reviewing it. We will respond to your query as soon as possible. We request that you to please share the below information so that we can proceed with the to troubleshooting – • Dell Customer Number - • Company Name – Thank you for choosing Dell Technologies. Regards, Younes Senior Technician, Technical Support, Global Service Desk Dell Technologies | Services --------------- Original Message --------------- From: Kevin Atkinson [kevin.atkinson@hkpseattle.com] Sent: 4/9/2024, 7:49 PM To: cloudsoftwarehelp@dell.com Subject: Retention Policy not Working ? [EXTERNAL EMAIL] To whom it may concern, We have a journal email box that is full \uf04c This mailbox is important, as it supposed to capture all the email that is sent/received for archive purposes. I’ve reached out to our Dell rep to see if we can increase the size for this account (I’m working on more than one solution at a time.) The reason I need your help is because I tried to also apply a Retention policy to this account (which should have resulted in another 50GB of space), but the Retention policy is not working. (?) Via PowerShell, I confirmed the policy is in place for the mailbox journal@hkpseattle.com. I also confirmed that the policy name is indeed associated with “Default 2 year move to archive”. Thereafter, I triggered the archiving via PowerShell (Start-ManagedFolderAssistant -Identity journal@hkpseattle.com ). It did not return any errors… but it also did not move anything to the In-Place Archive. All this to say… I’m trying to get this mailbox to shift anything older than 2 years to the In-Place archive, but it’s not working and I’m out of ideas. Is this something you can assist with please? Thanks, Kevin Kevin Atkinson Director of Operations Hagen, Kurth, Perman & Co., P.S. 1111 Third Ave, Suite 800 Seattle, WA 98101 (206) 682-9200 www.hkpseattle.com [hkpseattle.com] thread::Zr2JDBp_LUq5_ZaJ5Rm0KD0::"}, {'role': 'assistant', 'content': "To assist you with troubleshooting the Exchange mailbox issue using PowerShell as per the recommendations from Dell, let's break down the steps you need to follow. This will help you connect to Exchange Online via PowerShell, execute the necessary commands, and analyze the results.\n\n### Step 1: Connect to Exchange Online via PowerShell\nBefore you can run any commands, you need to establish a connection to Exchange Online. Here’s how you can do it:\n\n1. **Open PowerShell**: Run it as an administrator.\n2. **Install the Exchange Online Management Module** (if not already installed):\n   ```powershell\n   Install-Module -Name ExchangeOnlineManagement\n   ```\n3. **Connect to Exchange Online**:\n   ```powershell\n   Connect-ExchangeOnline -UserPrincipalName kevin.atkinson@hkpseattle.com\n   ```\n   - Enter your credentials when prompted.\n\n### Step 2: Execute Dell's Recommended PowerShell Commands\nNow that you are connected, you can run the commands provided by Dell.\n\n#### Command 1: Identify the Policies Assigned to the Mailbox\n```powershell\nGet-Mailbox -Identity journal@hkpseattle.com | fl InPlaceHolds, Retention*, ELC*\n```\n- This command will list the retention policies and holds applied to the mailbox.\n\n#### Command 2: Start the Managed Folder Assistant\n```powershell\nStart-ManagedFolderAssistant -Identity journal@hkpseattle.com -FullCrawl\n```\n- This command initiates a full crawl of the mailbox by the Managed Folder Assistant, which can help apply retention policies.\n\n#### Command 3: Verify MFA Processing\n```powershell\n$MRMLogs = [xml] ((Export-MailboxDiagnosticLogs -Identity journal@hkpseattle.com -ExtendedProperties).mailboxlog)\n$MRMLogs.Properties.MailboxTable.Property | ? {$_.Name -like “*ELC*”}\n```\n- This will show the number of deleted or archived items and the timestamp of the last successful run.\n\n#### Command 4: Check Folder Statistics\n```powershell\nGet-MailboxFolderStatistics -Identity journal@hkpseattle.com -FolderScope inbox -IncludeOldestAndNewestItems -IncludeAnalysis | select name, items*, oldes*, top*\n```\n- This command provides statistics about the mailbox folders, helping you identify any large items or folders.\n\n### Step 3: Analyze the Output\nAfter running these commands, carefully review the outputs. Look for:\n- **Policies applied**: Ensure the correct retention policies are listed.\n- **Managed Folder Assistant status**: Check if the assistant has processed items as expected.\n- **Folder statistics**: Identify any anomalies like oversized items or folders with an unusually high number of items.\n\n### Step 4: Follow Up\nBased on the outputs, you might need to adjust the retention policies or troubleshoot further if items aren't being archived as expected. If issues persist:\n- **Revisit the retention policy settings** in the Exchange admin center.\n- **Contact Dell support** with the outputs of the commands for further analysis.\n\n### Additional Resources\nFor more detailed guidance on managing Exchange Online via PowerShell, Microsoft’s documentation is an excellent resource:\n- [Exchange Online PowerShell](https://docs.microsoft.com/en-us/powershell/exchange/exchange-online-powershell?view=exchange-ps)\n- [Troubleshooting retention policies in Exchange Online](https://techcommunity.microsoft.com/t5/exchange-team-blog/troubleshooting-retention-policies-in-exchange-online/ba-p/3750197)\n\nBy following these steps, you should be able to effectively troubleshoot the retention policy issues with your Exchange mailbox. If you encounter any errors during the process or need further clarification on the commands, feel free to ask."}]
